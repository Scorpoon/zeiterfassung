<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="de">
  <head>
    <title>Zeiterfassung - Personen</title>
  </head>
  <body>
    <th:block th:fragment="section(user, workingTimes)">
      <div class="flex gap-2 items-center">
        <a
          href="#"
          th:href="@{/users/{id}/working-time/new (id=${user.id}, query=${query})}"
          class="flex items-center gap-2 py-1 pl-3 pr-4 text-gray-400 border border-gray-300 bg-white rounded-lg transition-colors hover:text-gray-500 hover:border-gray-500 focus:text-gray-500 focus:border-gray-500"
          data-turbo-action="advance"
        >
          <svg th:replace="~{icons/plus::svg(className='w-5 h-5')}"></svg>
          <th:block
            th:text="#{usermanagement.working-time.add-new-working-time-entry}"
          >
            Neu
          </th:block>
        </a>
        <a
          th:if="${#lists.size(workingTimes) == 1}"
          href="#"
          th:href="@{/users/{id}/working-time/{workingTimeId} (id=${user.id},workingTimeId=${workingTimes[0].id})}"
          class="flex items-center gap-2 py-1 pl-3 pr-4 text-gray-400 border border-gray-300 bg-white rounded-lg transition-colors hover:text-gray-500 hover:border-gray-500 focus:text-gray-500 focus:border-gray-500"
          data-turbo-action="advance"
        >
          <svg th:replace="~{icons/edit::svg(className='w-4 h-4')}"></svg>
          <th:block>Bearbeiten</th:block>
        </a>
      </div>
      <th:block th:if="${#lists.size(workingTimes) > 1}">
        <ul class="mt-8">
          <li
            th:each="workingTime : ${workingTimes}"
            class="flex flex-col gap-1 border-t border-t-gray-100 py-2 first:border-t-0"
          >
            <details
              class="group"
              th:attrappend="open=${workingTime.isCurrent ? 'true' : null}"
            >
              <summary
                class="flex gap-1 items-center cursor-pointer"
                th:classappend="${workingTime.current ? 'font-bold' : ''}"
              >
                <svg
                  th:replace="~{icons/chevron-right::svg(className='w-5 h-5 transition-transform group-open:rotate-90')}"
                ></svg>
                <th:block
                  th:if="${workingTime.validFrom == null}"
                  th:text="#{usermanagement.working-time.multiple-working-time-summary.without-valid-from}"
                >
                  gültig ab unbekannt
                </th:block>
                <th:block
                  th:if="${workingTime.validFrom != null}"
                  th:text="#{usermanagement.working-time.multiple-working-time-summary(${workingTime.validFrom})}"
                >
                  gültig ab XX.XX.XXXX
                </th:block>
              </summary>
              <div
                th:ref="working-time-block"
                class="mt-4 mb-2 pl-6 flex flex-col gap-4"
              >
                <div>
                  <ul class="text-sm flex flex-col gap-4 sm:flex-row sm:gap-2">
                    <li
                      th:fragment="blubb(dayOfWeek, hours)"
                      th:with="dayOfWeek=${#objects.nullSafe(dayOfWeek, 'MONDAY')}, hours=${#objects.nullSafe(hours, workingTime.workingTimeMonday)}"
                      class="flex-1 shrink-0"
                    >
                      <span
                        class="w-32 font-bold"
                        th:text="${#messages.msg(dayOfWeek)}"
                      >
                        Montag
                      </span>
                      <span
                        class="flex rounded-lg border border-green-300 bg-white"
                      >
                        <span
                          class="rounded-lg bg-green-300 h-2"
                          th:with="max=${workingTime.max}, width=${((hours eq 0) or (max eq 0)) ? 0 : #numbers.formatDecimal((hours/max)*100, 2, 'POINT', 3, 'POINT')}"
                          th:styleappend="${'width:' + width + '%'}"
                        ></span>
                      </span>
                      <span
                        th:text="#{usermanagement.working-time.multiple-working-time.entry.hours(${hours})}"
                        class="whitespace-nowrap"
                      ></span>
                    </li>
                    <li
                      th:replace="~{::blubb(dayOfWeek='TUESDAY', hours=${workingTime.workingTimeTuesday})}"
                    ></li>
                    <li
                      th:replace="~{::blubb(dayOfWeek='WEDNESDAY', hours=${workingTime.workingTimeWednesday})}"
                    ></li>
                    <li
                      th:replace="~{::blubb(dayOfWeek='THURSDAY', hours=${workingTime.workingTimeThursday})}"
                    ></li>
                    <li
                      th:replace="~{::blubb(dayOfWeek='FRIDAY', hours=${workingTime.workingTimeFriday})}"
                    ></li>
                    <li
                      th:replace="~{::blubb(dayOfWeek='SATURDAY', hours=${workingTime.workingTimeSaturday})}"
                    ></li>
                    <li
                      th:replace="~{::blubb(dayOfWeek='SUNDAY', hours=${workingTime.workingTimeSunday})}"
                    ></li>
                  </ul>
                </div>
                <div
                  th:if="${workingTimeStat != null}"
                  class="flex items-center gap-2"
                  th:with="index=${workingTimeStat.index}"
                >
                  <a
                    href="#"
                    th:href="@{/users/{id}/working-time/{workingTimeId} (id=${user.id},workingTimeId=${workingTime.id})}"
                    class="flex items-center gap-2 py-1 pl-3 pr-4 text-gray-400 border border-gray-300 bg-white rounded-lg transition-colors hover:text-gray-500 hover:border-gray-500 focus:text-gray-500 focus:border-gray-500"
                    data-turbo-action="advance"
                  >
                    <svg
                      th:replace="~{icons/edit::svg(className='w-4 h-4')}"
                    ></svg>
                    <th:block>Bearbeiten</th:block>
                  </a>
                  <form
                    action="#"
                    th:action="@{/users/{id}/working-time/{workingTimeId}/delete (id=${user.id},workingTimeId=${workingTime.id})}"
                    th:if="${workingTime.isDeletable}"
                  >
                    <button
                      type="submit"
                      class="flex items-center gap-2 py-1 pl-3 pr-4 text-gray-400 border border-gray-300 bg-white rounded-lg transition-colors hover:text-gray-500 hover:border-gray-500 focus:text-gray-500 focus:border-gray-500"
                    >
                      <svg
                        th:replace="~{icons/trash::svg(className='w-4 h-4')}"
                      ></svg>
                      <th:block>Löschen</th:block>
                    </button>
                  </form>
                </div>
              </div>
            </details>
          </li>
        </ul>
      </th:block>
      <th:block
        th:if="${#lists.size(workingTimes) eq 1}"
        th:with="workingTime=${workingTimes[0]}"
      >
        <div class="mt-8">
          <div th:replace="~{::working-time-block}"></div>
        </div>
      </th:block>
    </th:block>
  </body>
</html>
